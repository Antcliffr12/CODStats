{"ast":null,"code":"function AxiosRateLimit(axios) {\n  this.queue = [];\n  this.timeslotRequests = 0;\n  this.interceptors = {\n    request: null,\n    response: null\n  };\n  this.handleRequest = this.handleRequest.bind(this);\n  this.handleResponse = this.handleResponse.bind(this);\n  this.enable(axios);\n}\n\nAxiosRateLimit.prototype.getMaxRPS = function () {\n  var perSeconds = this.perMilliseconds / 1000;\n  return this.maxRequests / perSeconds;\n};\n\nAxiosRateLimit.prototype.setMaxRPS = function (rps) {\n  this.setRateLimitOptions({\n    maxRequests: rps,\n    perMilliseconds: 1000\n  });\n};\n\nAxiosRateLimit.prototype.setRateLimitOptions = function (options) {\n  if (options.maxRPS) {\n    this.setMaxRPS(options.maxRPS);\n  } else {\n    this.perMilliseconds = options.perMilliseconds;\n    this.maxRequests = options.maxRequests;\n  }\n};\n\nAxiosRateLimit.prototype.enable = function (axios) {\n  function handleError(error) {\n    return Promise.reject(error);\n  }\n\n  this.interceptors.request = axios.interceptors.request.use(this.handleRequest, handleError);\n  this.interceptors.response = axios.interceptors.response.use(this.handleResponse, handleError);\n};\n\nAxiosRateLimit.prototype.handleRequest = function (request) {\n  return new Promise(function (resolve) {\n    this.push({\n      resolve: function () {\n        resolve(request);\n      }\n    });\n  }.bind(this));\n};\n\nAxiosRateLimit.prototype.handleResponse = function (response) {\n  this.shift();\n  return response;\n};\n\nAxiosRateLimit.prototype.push = function (requestHandler) {\n  this.queue.push(requestHandler);\n  this.shiftInitial();\n};\n\nAxiosRateLimit.prototype.shiftInitial = function () {\n  setTimeout(function () {\n    return this.shift();\n  }.bind(this), 0);\n};\n\nAxiosRateLimit.prototype.shift = function () {\n  if (!this.queue.length) return;\n\n  if (this.timeslotRequests === this.maxRequests) {\n    if (this.timeoutId && typeof this.timeoutId.ref === 'function') {\n      this.timeoutId.ref();\n    }\n\n    return;\n  }\n\n  var queued = this.queue.shift();\n  queued.resolve();\n\n  if (this.timeslotRequests === 0) {\n    this.timeoutId = setTimeout(function () {\n      this.timeslotRequests = 0;\n      this.shift();\n    }.bind(this), this.perMilliseconds);\n\n    if (typeof this.timeoutId.unref === 'function') {\n      if (this.queue.length === 0) this.timeoutId.unref();\n    }\n  }\n\n  this.timeslotRequests += 1;\n};\n/**\n * Apply rate limit to axios instance.\n *\n * @example\n *   import axios from 'axios';\n *   import rateLimit from 'axios-rate-limit';\n *\n *   // sets max 2 requests per 1 second, other will be delayed\n *   // note maxRPS is a shorthand for perMilliseconds: 1000, and it takes precedence\n *   // if specified both with maxRequests and perMilliseconds\n *   const http = rateLimit(axios.create(), { maxRequests: 2, perMilliseconds: 1000, maxRPS: 2 })\n*    http.getMaxRPS() // 2\n *   http.get('https://example.com/api/v1/users.json?page=1') // will perform immediately\n *   http.get('https://example.com/api/v1/users.json?page=2') // will perform immediately\n *   http.get('https://example.com/api/v1/users.json?page=3') // will perform after 1 second from the first one\n *   http.setMaxRPS(3)\n *   http.getMaxRPS() // 3\n *   http.setRateLimitOptions({ maxRequests: 6, perMilliseconds: 150 }) // same options as constructor\n *\n * @param {Object} axios axios instance\n * @param {Object} options options for rate limit, available for live update\n * @param {Number} options.maxRequests max requests to perform concurrently in given amount of time.\n * @param {Number} options.perMilliseconds amount of time to limit concurrent requests.\n * @returns {Object} axios instance with interceptors added\n */\n\n\nfunction axiosRateLimit(axios, options) {\n  var rateLimitInstance = new AxiosRateLimit(axios);\n  rateLimitInstance.setRateLimitOptions(options);\n  axios.getMaxRPS = AxiosRateLimit.prototype.getMaxRPS.bind(rateLimitInstance);\n  axios.setMaxRPS = AxiosRateLimit.prototype.setMaxRPS.bind(rateLimitInstance);\n  axios.setRateLimitOptions = AxiosRateLimit.prototype.setRateLimitOptions.bind(rateLimitInstance);\n  return axios;\n}\n\nmodule.exports = axiosRateLimit;","map":{"version":3,"sources":["/Users/antclir/Projects/Reactjs/cod/client/node_modules/axios-rate-limit/src/index.js"],"names":["AxiosRateLimit","axios","queue","timeslotRequests","interceptors","request","response","handleRequest","bind","handleResponse","enable","prototype","getMaxRPS","perSeconds","perMilliseconds","maxRequests","setMaxRPS","rps","setRateLimitOptions","options","maxRPS","handleError","error","Promise","reject","use","resolve","push","shift","requestHandler","shiftInitial","setTimeout","length","timeoutId","ref","queued","unref","axiosRateLimit","rateLimitInstance","module","exports"],"mappings":"AAAA,SAASA,cAAT,CAAyBC,KAAzB,EAAgC;AAC9B,OAAKC,KAAL,GAAa,EAAb;AACA,OAAKC,gBAAL,GAAwB,CAAxB;AAEA,OAAKC,YAAL,GAAoB;AAClBC,IAAAA,OAAO,EAAE,IADS;AAElBC,IAAAA,QAAQ,EAAE;AAFQ,GAApB;AAKA,OAAKC,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACA,OAAKC,cAAL,GAAsB,KAAKA,cAAL,CAAoBD,IAApB,CAAyB,IAAzB,CAAtB;AAEA,OAAKE,MAAL,CAAYT,KAAZ;AACD;;AAEDD,cAAc,CAACW,SAAf,CAAyBC,SAAzB,GAAqC,YAAY;AAC/C,MAAIC,UAAU,GAAI,KAAKC,eAAL,GAAuB,IAAzC;AACA,SAAO,KAAKC,WAAL,GAAmBF,UAA1B;AACD,CAHD;;AAKAb,cAAc,CAACW,SAAf,CAAyBK,SAAzB,GAAqC,UAAUC,GAAV,EAAe;AAClD,OAAKC,mBAAL,CAAyB;AACvBH,IAAAA,WAAW,EAAEE,GADU;AAEvBH,IAAAA,eAAe,EAAE;AAFM,GAAzB;AAID,CALD;;AAOAd,cAAc,CAACW,SAAf,CAAyBO,mBAAzB,GAA+C,UAAUC,OAAV,EAAmB;AAChE,MAAIA,OAAO,CAACC,MAAZ,EAAoB;AAClB,SAAKJ,SAAL,CAAeG,OAAO,CAACC,MAAvB;AACD,GAFD,MAEO;AACL,SAAKN,eAAL,GAAuBK,OAAO,CAACL,eAA/B;AACA,SAAKC,WAAL,GAAmBI,OAAO,CAACJ,WAA3B;AACD;AACF,CAPD;;AASAf,cAAc,CAACW,SAAf,CAAyBD,MAAzB,GAAkC,UAAUT,KAAV,EAAiB;AACjD,WAASoB,WAAT,CAAsBC,KAAtB,EAA6B;AAC3B,WAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD;;AAED,OAAKlB,YAAL,CAAkBC,OAAlB,GAA4BJ,KAAK,CAACG,YAAN,CAAmBC,OAAnB,CAA2BoB,GAA3B,CAC1B,KAAKlB,aADqB,EAE1Bc,WAF0B,CAA5B;AAIA,OAAKjB,YAAL,CAAkBE,QAAlB,GAA6BL,KAAK,CAACG,YAAN,CAAmBE,QAAnB,CAA4BmB,GAA5B,CAC3B,KAAKhB,cADsB,EAE3BY,WAF2B,CAA7B;AAID,CAbD;;AAeArB,cAAc,CAACW,SAAf,CAAyBJ,aAAzB,GAAyC,UAAUF,OAAV,EAAmB;AAC1D,SAAO,IAAIkB,OAAJ,CAAY,UAAUG,OAAV,EAAmB;AACpC,SAAKC,IAAL,CAAU;AAAED,MAAAA,OAAO,EAAE,YAAY;AAAEA,QAAAA,OAAO,CAACrB,OAAD,CAAP;AAAkB;AAA3C,KAAV;AACD,GAFkB,CAEjBG,IAFiB,CAEZ,IAFY,CAAZ,CAAP;AAGD,CAJD;;AAMAR,cAAc,CAACW,SAAf,CAAyBF,cAAzB,GAA0C,UAAUH,QAAV,EAAoB;AAC5D,OAAKsB,KAAL;AACA,SAAOtB,QAAP;AACD,CAHD;;AAKAN,cAAc,CAACW,SAAf,CAAyBgB,IAAzB,GAAgC,UAAUE,cAAV,EAA0B;AACxD,OAAK3B,KAAL,CAAWyB,IAAX,CAAgBE,cAAhB;AACA,OAAKC,YAAL;AACD,CAHD;;AAKA9B,cAAc,CAACW,SAAf,CAAyBmB,YAAzB,GAAwC,YAAY;AAClDC,EAAAA,UAAU,CAAC,YAAY;AAAE,WAAO,KAAKH,KAAL,EAAP;AAAqB,GAAnC,CAAoCpB,IAApC,CAAyC,IAAzC,CAAD,EAAiD,CAAjD,CAAV;AACD,CAFD;;AAIAR,cAAc,CAACW,SAAf,CAAyBiB,KAAzB,GAAiC,YAAY;AAC3C,MAAI,CAAC,KAAK1B,KAAL,CAAW8B,MAAhB,EAAwB;;AACxB,MAAI,KAAK7B,gBAAL,KAA0B,KAAKY,WAAnC,EAAgD;AAC9C,QAAI,KAAKkB,SAAL,IAAkB,OAAO,KAAKA,SAAL,CAAeC,GAAtB,KAA8B,UAApD,EAAgE;AAC9D,WAAKD,SAAL,CAAeC,GAAf;AACD;;AAED;AACD;;AAED,MAAIC,MAAM,GAAG,KAAKjC,KAAL,CAAW0B,KAAX,EAAb;AACAO,EAAAA,MAAM,CAACT,OAAP;;AAEA,MAAI,KAAKvB,gBAAL,KAA0B,CAA9B,EAAiC;AAC/B,SAAK8B,SAAL,GAAiBF,UAAU,CAAC,YAAY;AACtC,WAAK5B,gBAAL,GAAwB,CAAxB;AACA,WAAKyB,KAAL;AACD,KAH2B,CAG1BpB,IAH0B,CAGrB,IAHqB,CAAD,EAGb,KAAKM,eAHQ,CAA3B;;AAKA,QAAI,OAAO,KAAKmB,SAAL,CAAeG,KAAtB,KAAgC,UAApC,EAAgD;AAC9C,UAAI,KAAKlC,KAAL,CAAW8B,MAAX,KAAsB,CAA1B,EAA6B,KAAKC,SAAL,CAAeG,KAAf;AAC9B;AACF;;AAED,OAAKjC,gBAAL,IAAyB,CAAzB;AACD,CAzBD;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASkC,cAAT,CAAyBpC,KAAzB,EAAgCkB,OAAhC,EAAyC;AACvC,MAAImB,iBAAiB,GAAG,IAAItC,cAAJ,CAAmBC,KAAnB,CAAxB;AACAqC,EAAAA,iBAAiB,CAACpB,mBAAlB,CAAsCC,OAAtC;AAEAlB,EAAAA,KAAK,CAACW,SAAN,GAAkBZ,cAAc,CAACW,SAAf,CAAyBC,SAAzB,CAAmCJ,IAAnC,CAAwC8B,iBAAxC,CAAlB;AACArC,EAAAA,KAAK,CAACe,SAAN,GAAkBhB,cAAc,CAACW,SAAf,CAAyBK,SAAzB,CAAmCR,IAAnC,CAAwC8B,iBAAxC,CAAlB;AACArC,EAAAA,KAAK,CAACiB,mBAAN,GAA4BlB,cAAc,CAACW,SAAf,CAAyBO,mBAAzB,CACzBV,IADyB,CACpB8B,iBADoB,CAA5B;AAGA,SAAOrC,KAAP;AACD;;AAEDsC,MAAM,CAACC,OAAP,GAAiBH,cAAjB","sourcesContent":["function AxiosRateLimit (axios) {\n  this.queue = []\n  this.timeslotRequests = 0\n\n  this.interceptors = {\n    request: null,\n    response: null\n  }\n\n  this.handleRequest = this.handleRequest.bind(this)\n  this.handleResponse = this.handleResponse.bind(this)\n\n  this.enable(axios)\n}\n\nAxiosRateLimit.prototype.getMaxRPS = function () {\n  var perSeconds = (this.perMilliseconds / 1000)\n  return this.maxRequests / perSeconds\n}\n\nAxiosRateLimit.prototype.setMaxRPS = function (rps) {\n  this.setRateLimitOptions({\n    maxRequests: rps,\n    perMilliseconds: 1000\n  })\n}\n\nAxiosRateLimit.prototype.setRateLimitOptions = function (options) {\n  if (options.maxRPS) {\n    this.setMaxRPS(options.maxRPS)\n  } else {\n    this.perMilliseconds = options.perMilliseconds\n    this.maxRequests = options.maxRequests\n  }\n}\n\nAxiosRateLimit.prototype.enable = function (axios) {\n  function handleError (error) {\n    return Promise.reject(error)\n  }\n\n  this.interceptors.request = axios.interceptors.request.use(\n    this.handleRequest,\n    handleError\n  )\n  this.interceptors.response = axios.interceptors.response.use(\n    this.handleResponse,\n    handleError\n  )\n}\n\nAxiosRateLimit.prototype.handleRequest = function (request) {\n  return new Promise(function (resolve) {\n    this.push({ resolve: function () { resolve(request) } })\n  }.bind(this))\n}\n\nAxiosRateLimit.prototype.handleResponse = function (response) {\n  this.shift()\n  return response\n}\n\nAxiosRateLimit.prototype.push = function (requestHandler) {\n  this.queue.push(requestHandler)\n  this.shiftInitial()\n}\n\nAxiosRateLimit.prototype.shiftInitial = function () {\n  setTimeout(function () { return this.shift() }.bind(this), 0)\n}\n\nAxiosRateLimit.prototype.shift = function () {\n  if (!this.queue.length) return\n  if (this.timeslotRequests === this.maxRequests) {\n    if (this.timeoutId && typeof this.timeoutId.ref === 'function') {\n      this.timeoutId.ref()\n    }\n\n    return\n  }\n\n  var queued = this.queue.shift()\n  queued.resolve()\n\n  if (this.timeslotRequests === 0) {\n    this.timeoutId = setTimeout(function () {\n      this.timeslotRequests = 0\n      this.shift()\n    }.bind(this), this.perMilliseconds)\n\n    if (typeof this.timeoutId.unref === 'function') {\n      if (this.queue.length === 0) this.timeoutId.unref()\n    }\n  }\n\n  this.timeslotRequests += 1\n}\n\n/**\n * Apply rate limit to axios instance.\n *\n * @example\n *   import axios from 'axios';\n *   import rateLimit from 'axios-rate-limit';\n *\n *   // sets max 2 requests per 1 second, other will be delayed\n *   // note maxRPS is a shorthand for perMilliseconds: 1000, and it takes precedence\n *   // if specified both with maxRequests and perMilliseconds\n *   const http = rateLimit(axios.create(), { maxRequests: 2, perMilliseconds: 1000, maxRPS: 2 })\n*    http.getMaxRPS() // 2\n *   http.get('https://example.com/api/v1/users.json?page=1') // will perform immediately\n *   http.get('https://example.com/api/v1/users.json?page=2') // will perform immediately\n *   http.get('https://example.com/api/v1/users.json?page=3') // will perform after 1 second from the first one\n *   http.setMaxRPS(3)\n *   http.getMaxRPS() // 3\n *   http.setRateLimitOptions({ maxRequests: 6, perMilliseconds: 150 }) // same options as constructor\n *\n * @param {Object} axios axios instance\n * @param {Object} options options for rate limit, available for live update\n * @param {Number} options.maxRequests max requests to perform concurrently in given amount of time.\n * @param {Number} options.perMilliseconds amount of time to limit concurrent requests.\n * @returns {Object} axios instance with interceptors added\n */\nfunction axiosRateLimit (axios, options) {\n  var rateLimitInstance = new AxiosRateLimit(axios)\n  rateLimitInstance.setRateLimitOptions(options)\n\n  axios.getMaxRPS = AxiosRateLimit.prototype.getMaxRPS.bind(rateLimitInstance)\n  axios.setMaxRPS = AxiosRateLimit.prototype.setMaxRPS.bind(rateLimitInstance)\n  axios.setRateLimitOptions = AxiosRateLimit.prototype.setRateLimitOptions\n    .bind(rateLimitInstance)\n\n  return axios\n}\n\nmodule.exports = axiosRateLimit\n"]},"metadata":{},"sourceType":"script"}